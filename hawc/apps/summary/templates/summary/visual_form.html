{% extends 'assessment-rooted.html' %}

{% block content %}
  <div id="main" style="display:none;"></div>
  <div id="formContainer" style="display:none;">
    {% crispy form %}
  </div>
  {% include "summary/_smartTagEditModal.html" with modal_id="smartTagModal" form=smart_tag_form only %}
{% endblock %}

{% block extrajs %}
  {{ smart_tag_form.media }}
  <script id="config" type="text/json" charset="utf-8">
    {
      "assessment": {{assessment.id}},
      "crud": "{{crud}}",
      "csrf": "{{csrf_token}}",
      "instance": {{instance|safe}},
      "visual_type": {{visual_type}},
      "cancel_url": "{% if crud == "Create" %}{% url 'summary:visualization_list' pk=assessment.id %}{% else %}{{object.get_absolute_url}}{% endif %}",
      "data_url": "{% url 'summary:api:visual-list' %}",
      {% if crossview_config %}"crossview_config": {{crossview_config|safe}},{% endif %}
      {% if rob_config %}"rob_config": {{rob_config|safe}},{% endif %}
      {% if api_data_url %}"api_data_url": "{{api_data_url|safe}}",{% endif %}
      "initial_data": {{initial_data|safe}},
      "api_heatmap_datasets": "{{form.instance.get_api_heatmap_datasets}}",
      "clear_cache_url": "{{assessment.get_clear_cache_url}}",
      "isCreate": {% if crud == "Create" %}true{% else %}false{% endif %}
    }
  </script>
  <script type="text/javascript">
    window.app.startup("summaryFormsStartup", function(summaryForms){
      const config = window.app.getConfig(),
            djangoForm = document.querySelector('#visualForm'),
            mainElement = document.querySelector('#main');
      summaryForms.startup(config, djangoForm, mainElement);
    });
  </script>
{% endblock %}
