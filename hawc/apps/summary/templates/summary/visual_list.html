{% extends 'assessment-rooted.html' %}

{% block content %}
  <div class="d-flex">
    <h2>Available visualizations</h2>
    {% if obj_perms.edit %}
      {% actions %}
        <a class="dropdown-item" href="{% url 'summary:visualization_create_selector' assessment.pk %}">
          <i class="fa fa-fw fa-edit"></i>&nbsp;Create new visual
        </a>
        <a class="dropdown-item" href="{% url 'summary:visualization_copy_selector' assessment.pk %}">
          <i class="fa fa-fw fa-copy"></i>&nbsp;Copy from existing
        </a>
      {% endactions %}
    {% endif %}
  </div>

  {% include 'common/inline_filter_form.html' %}

  <table id="mainTbl" class="table table-sm table-striped">
    {% bs4_colgroup "50,26,12,12" %}
    {% bs4_thead "Visual,Type,Created,Modified" %}
    <tbody>
      {% for visual in objects %}
        <tr>
          <td>
            <div class="d-flex align-items-center">
              <a class="text-nowrap" href="{{visual.get_absolute_url}}">{{visual.title}}</a>
              {% for labeled_item in visual.visible_labels %}
                <a class="tny mx-1 label" href="{{labeled_item.label.get_labeled_items_url}}" style="background-color: {{labeled_item.label.color}}; color: {{labeled_item.label.text_color}};" title="{{labeled_item.label.description}}">{{labeled_item.label.name}}</a>
              {% endfor %}
              {% for labeled_item in visual.datapivotquery.visible_query_labels %}
                <a class="tny mx-1 label" href="{{labeled_item.label.get_labeled_items_url}}" style="background-color: {{labeled_item.label.color}}; color: {{labeled_item.label.text_color}};" title="{{labeled_item.label.description}}">{{labeled_item.label.name}}</a>
              {% endfor %}
              {% for labeled_item in visual.datapivotupload.visible_upload_labels %}
                <a class="tny mx-1 label" href="{{labeled_item.label.get_labeled_items_url}}" style="background-color: {{labeled_item.label.color}}; color: {{labeled_item.label.text_color}};" title="{{labeled_item.label.description}}">{{labeled_item.label.name}}</a>
              {% endfor %}
              {% if not visual.published %}
                <i class="fa fa-eye-slash mx-1" title="Unpublished (not be visible to the public)" aria-hidden="true"></i>
              {% endif %}
              {% debug_badge visual.id %}
              {% if visual.caption %}
                <div class='text-muted mx-1 text-nowrap' title="{{visual.caption|striptags|safe}}">{{visual.caption|striptags|truncatewords:20|safe}}</div>
              {% endif %}
            </div>
          </td>
          <td>{{visual.get_visual_type_display}}</td>
          <td>{{ visual.created|date:"Y-m-d" }}</td>
          <td>{{ visual.last_updated|date:"Y-m-d" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <p><b>{{n_objects}}</b> visual{{n_objects|pluralize}} found.</p>
{% endblock content %}

{% block extrajs %}
  <script type="text/javascript">
    $(document).ready(function(){
      window.app.HAWCUtils.tablesort(document.getElementById('mainTbl'));
    });
  </script>
{% endblock extrajs %}
