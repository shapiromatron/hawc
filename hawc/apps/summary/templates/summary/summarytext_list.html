{% extends 'assessment-rooted.html' %}

{% block bodyattrs %}data-spy="scroll" data-target="#sidebar" data-offset="40"{% endblock %}

{% block main_content %}
  <div class="row">
    <ol class="breadcrumb">
      {% if user.is_authenticated %}
        <li class="breadcrumb-item"><a href="{% url 'portal' %}">Home</a></li>
      {% else %}
        <li class="breadcrumb-item"><a href="{% url 'assessment:public_list' %}">Public Assessments</a></li>
      {% endif %}

      {% block breadcrumbs %}
        <li class="breadcrumb-item"><a href="{{assessment.get_absolute_url}}">{{assessment}}</a></li>
        <li class="breadcrumb-item active">Summary</li>
      {% endblock breadcrumbs %}
    </ol>
  </div>

  <div class="row">
    <div id="sidebar" class="col-md-3">
      <ul id="st_headers_ul" class="nav nav-list well affix-sidenav" data-spy="affix" data-offset-top="65">
      </ul>
    </div>

    <div class="col-md-9">

      <h1>{{assessment}} Summary
        <div class="dropdown btn-group float-right">
          <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown">Actions</a>
          <div class="dropdown-menu dropdown-menu-right">
            <a class="dropdown-item" href="#" id="smart_tag_toggle">Toggle Smart-Tags</a>
            {% if obj_perms.edit %}
              <a class="dropdown-item" href="{% url 'summary:create' assessment.pk %}">Update text</a>
            {% endif %}
          </div>
        </div>
      </h1>

      <div id="st_text_div"></div>

    </div>
  </div>
{% endblock %}


{% block extrajs %}
  <script type="text/javascript">
    window.app.summaryStartup(function(summary){

      new summary.SummaryTextTree({
        "assessment_id": {{assessment.pk}},
        "mode": "read",
        "read_headers_ul": $('#st_headers_ul'),
        "read_text_div": $('#st_text_div'),
        "user": {%if request.user.is_authenticated %}{{request.user.pk}}{% else %}-1{% endif %}
      });

      window.app.smartTagsStartup(function(smartTags){
          $('#smart_tag_toggle').on('click', function(e){
            smartTags.SmartTagContainer.toggleAllModals('#st_text_div');
          })
      })

    });
  </script>
{% endblock extrajs %}
