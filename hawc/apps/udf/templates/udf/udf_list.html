{% extends 'crumbless.html' %}

{% block content %}
<div class="d-flex align-items-start">
    <h2 class="mt-0 mb-2">User Defined Forms</h2>
    <a class="ml-auto btn btn-primary mt-1" href="{% url 'udf:udf_create' %}">Create a form</a>
</div>
<div class="list-group mb-4">
    {% for object in object_list %}
    <div class="list-group-item p-4">
        <div class="d-flex align-items-start">
            <div class="col-md-11 px-0">
                <div class="d-flex align-items-center">
                    <h4 class="mb-0" style="font-size: 1.15rem;">{{object.name}}</h4>
                    {% if object.deprecated %}
                        <span class="badge ml-2 p-1 text-danger border border-danger">
                            Deprecated</span>
                    {% endif %}
                </div>  
                <i class="text-muted my-1 d-block" style="text-overflow:ellipsis; overflow:hidden; white-space: nowrap;">{{object.description}}</i>
            </div>
            <div class="ml-auto">
                {% if object.user_can_edit %}
                <a class="btn outline-btn px-3" href="{{object.get_update_url}}">
                    Update
                </a>
                {% endif %}
            </div>
        </div>
        <div class="d-flex align-items-start flex-wrap udf-info-row">
            <div class="card mt-2 mr-2 flex-shrink-0">
                <a class="px-3 py-2 clickable box-shadow-minor" data-toggle="collapse" href="#udf-{{object.id}}-preview" aria-expanded="false" aria-controls="udf-{{object.id}}-preview">Preview &nbsp;<i class="fa fa-angle-down" aria-hidden="true"></i> </a>
            </div>
           
            <div class="card mt-2 mr-2 flex-shrink-0" style="width: 11rem;">
                {% if object.assessments.exists %}
                <a class="p-2 mb-0 text-center clickable box-shadow-minor clickable" data-toggle="collapse" href="#udf-{{object.id}}-assessments" aria-expanded="false" aria-controls="#udf-{{object.id}}-assessments" style="position:relative; z-index: 1; scrollbar-gutter: stable;"> {{object.assessments.count}} assessment{{object.assessments.count|pluralize}} &nbsp; <i class="fa fa-angle-down" aria-hidden="true"></i></a>
                <div id="udf-{{object.id}}-assessments" class="collapse list-group list-group-flush rounded" style="position:relative; z-index: 0; max-height: 10rem; overflow-y: scroll;">
                    {% for assessment in object.assessments.all %}
                    <a class="list-group-item list-group-item-action py-1 px-3 small" href="{{assessment.get_absolute_url}}">{{assessment.name}}</a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="p-2 mb-0 text-center text-muted">No assessments</p>
                {% endif %}
            </div>
            <div class="card mt-2 mr-2 flex-shrink-0" style="width: 9rem;">
                {% if object.editors.exists %}
                <a class="p-2 mb-0 text-center box-shadow-minor  {% if object.editors.exists %} clickable {% endif %}" data-toggle="collapse" href="#udf-{{object.id}}-editors" aria-expanded="false" aria-controls="#udf-{{object.id}}-editors" style="position:relative; z-index: 1; scrollbar-gutter: stable; height:2.6rem;"> {{object.editors.count}} editor{{object.editors.count|pluralize}} &nbsp; <i class="fa fa-angle-down" aria-hidden="true"></i></a>
                <div id="udf-{{object.id}}-editors" class="collapse list-group list-group-flush rounded" style="position:relative; z-index: 0; max-height: 10rem; overflow-y: scroll;">
                    {% for editor in object.editors.all %}
                    <div class="list-group-item py-1 px-3 small">{{editor}}</div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="p-2 mb-0 text-center text-muted">No editors</p>
                {% endif %}
            </div>
            <div class="card mt-2 mr-2 p-2 {{ object.published|yesno:'border-success text-success,text-muted' }}" title="{{ object.published|yesno:'Published,Unpublished' }}">
                <p class="m-0"><i class="fa fa-{{ object.published|yesno:'eye,eye-slash' }} px-1" style="font-size: large;"></i></p>
            </div>
            <div class="card mt-2 mr-2 p-2">
                <p class="text-muted small m-0">Created by {{object.creator}}</p>
            </div>
            <div class="card mt-2 mr-2 p-2">
                <p class="m-0 small text-muted">Updated {{object.last_updated|date:"DATE_FORMAT"}}
                </p>
            </div>
        </div>
        <div id="udf-{{object.id}}-preview" class="collapse mt-3 rounded box-shadow">
            <form id="udf-{{object.id}}" class="bg-lightblue p-4 rounded">
                {% crispy object.form %}
            </form>
        </div>
    </div>
    {% empty %}
    {% alert info %}No forms found.{% endalert %}
    {% endfor %}  
</div>

  {% include "includes/paginator.html" with plural_object_name="forms" %}
{% endblock content %}

{% block extrajs %}
<script>
    window.app.HAWCUtils.dynamicFormListeners();
</script>
{% endblock extrajs %}
