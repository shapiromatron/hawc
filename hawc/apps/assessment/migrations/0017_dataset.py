# Generated by Django 2.2.11 on 2020-06-03 21:23

import django.contrib.postgres.fields.jsonb
import django.core.files.storage
import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ("assessment", "0016_assessment_is_public_training_data"),
    ]

    operations = [
        migrations.CreateModel(
            name="Dataset",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                ("name", models.CharField(max_length=256)),
                ("description", models.TextField(blank=True)),
                ("created", models.DateTimeField(auto_now_add=True)),
                ("last_updated", models.DateTimeField(auto_now=True)),
                (
                    "assessment",
                    models.ForeignKey(
                        editable=False,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="datasets",
                        to="assessment.Assessment",
                    ),
                ),
            ],
            options={"ordering": ("created",), "unique_together": {("assessment", "name")}},
        ),
        migrations.CreateModel(
            name="DatasetRevision",
            fields=[
                (
                    "id",
                    models.AutoField(
                        auto_created=True, primary_key=True, serialize=False, verbose_name="ID"
                    ),
                ),
                (
                    "version",
                    models.PositiveSmallIntegerField(
                        help_text="The uploaded file is versioned; this is the version of the dataset currently\n            being edited."
                    ),
                ),
                (
                    "data",
                    models.FileField(
                        help_text="Upload a dataset (.csv, .tsv, .xlsx).\n            Dataset versions cannot be deleted, but if users are not team members, only the most\n            recent dataset version will be visible. Visualizations using a dataset will use the\n            latest version available.",
                        storage=django.core.files.storage.FileSystemStorage(
                            location="/Users/shapiromatron/dev/hawc/private"
                        ),
                        upload_to="assessment/dataset-revision",
                    ),
                ),
                (
                    "metadata",
                    django.contrib.postgres.fields.jsonb.JSONField(default=dict, editable=False),
                ),
                (
                    "excel_worksheet_name",
                    models.CharField(
                        blank=True,
                        help_text="Worksheet name to use in Excel file. If blank, the first worksheet is used.",
                        max_length=64,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        help_text="Notes on specific revision. For example, describe what's different from a\n            previous version. After save, cannot be edited.",
                    ),
                ),
                ("created", models.DateTimeField(auto_now_add=True)),
                ("last_updated", models.DateTimeField(auto_now=True)),
                (
                    "dataset",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="revisions",
                        to="assessment.Dataset",
                    ),
                ),
            ],
            options={
                "ordering": ("created",),
                "get_latest_by": "created",
                "unique_together": {("dataset", "version")},
            },
        ),
    ]
