{% extends 'breadcrumbed.html' %}

{% block content %}
  <div class="row m-auto">
    <h1>
      Welcome, {{ user.get_full_name }}.
    </h1>
    <div class="dropdown ml-auto">
      <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Actions
      </button>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
        <h6 class="dropdown-header">Assessment Editing</h6>
        {% if user.can_create_assessments %}
        <a class="dropdown-item" href="{% url 'assessment:new' %}">Create a new assessment</a>
        {% else %}
        <p class="dropdown-item help-block">
          Assessment creation disabled - please <a href="{% url 'contact' %}">contact us</a> if needed.
        </p>
        {% endif %}
        {% if user.is_superuser %}
        <div class="dropdown-divider"></div>
        <h6 class="dropdown-header">Staff settings</h6>
        <a class="dropdown-item" href="{% url 'assessment:full_list' %}">View all assessments</a>
        {% endif %}
      </div>
    </div>
  </div>

  {% if show_v2_license %}
    <div class="alert alert-warning">
      <b>HAWC license</b>
      <p>The HAWC license has changed. Please
        <a href="#" data-toggle="modal" data-target="#license_modal">review the license</a>
        and accept:
      </p>
      <form action="{% url 'user:accept-new-license' %}" method="post">
        {% csrf_token %}

        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="license_v2_accepted" id="license_v2_accepted">
          <label class="form-check-label" for="license_v2_accepted">
            I accept this license
          </label>
        </div>

        <div class="form-group">
          <button class="btn btn-primary" type="submit">Submit</button>
        </div>
      </form>
    </div>
    {% include "registration/license.html" %}
  {% endif %}

  <p>
    Welcome to the HAWC portal. Here you're able to create new assessments,
    or work on existing assessments. Each assessment is a single human-health
    risk assessment. You can view assessments by the role you've been assigned.
  </p>

  {% with assessments=user.assessment_pms.all %}
    {% if assessments %}
      <h2>Assessments you're managing:</h2>
      {% include "assessment/_assessment_list_tbl.html" with object_list=assessments %}
    {% endif %}
  {% endwith %}

  {% with assessments=user.assessment_teams.all %}
    {% if assessments %}
      <h2>Assessments you're a team-member on:</h2>
      {% include "assessment/_assessment_list_tbl.html" with object_list=assessments %}
    {% endif %}
  {% endwith %}

  {% with assessments=user.assessment_reviewers.all %}
    {% if assessments %}
      <h2>Assessments you can review:</h2>
      {% include "assessment/_assessment_list_tbl.html" with object_list=assessments %}
    {% endif %}
  {% endwith %}

{% endblock content %}

{% block extrajs %}
<script id='data' type='text/json'>
{
  "heroAccess": {{user.profile.HERO_access|yesno:"true,false"}}
}
</script>
<script type="text/javascript">
  const data = JSON.parse(document.getElementById('data').textContent);
  window.app.utils.HEROUtils.setHeroAccess(data.heroAccess);
</script>
{% endblock extrajs %}
