{% extends 'portal.html' %}


{% block title %}
{% include "hawc/siteTitle.html" with crumbs=object.get_crumbs crud=crud %}
{% endblock title %}

{% block breadcrumbs %}
{% include "hawc/breadcrumbs.html" with crumbs=object.get_crumbs crud=crud %}
{% endblock %}

{% block content %}
<h1>{{object}}
    {% if crud == "Read" and obj_perms.edit %}
    <div class="btn-group pull-right">
        <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown">Actions
            <span class="caret"></span>
        </a>
        <ul class="dropdown-menu">
            <li class="disabled"><a tabindex="-1" href="#">Dataset Editing</a></li>
            <li><a href="{{ object.get_edit_url }}">Update dataset</a></li>
            <li><a href="{{ object.get_delete_url }}">Delete dataset</a></li>
        </ul>
    </div>
    {% endif %}
</h1>

<table class="table table-condensed table-striped">
    <colgroup>
        <col style="width: 30%;">
        <col style="width: 70%;">
    </colgroup>
    <tbody>
        <tr>
        <tr>
            <th>Description</th>
            <td>{{object.description|safe}}</td>
        </tr>
        {% if object.revisions.count > 0 %}
        {% with revision=object.get_latest_revision %}
        <tr>
            <th>Metadata</th>
            <td>
                <ul>
                    <li><b>Current version: </b>{{revision.version}}</li>
                    <li><b>Filename:</b> {{revision.metadata.filename}}</li>
                    <li><b>Rows:</b> {{revision.metadata.num_rows}}</li>
                    <li><b>Columns:</b> {{revision.metadata.num_columns}}</li>
                    <li><b>Revision notes:</b> {{revision.notes|safe}}</li>
                </ul>
            </td>
        </tr>
        {% endwith %}
        {% endif %}

        <tr>
            <th>Created</th>
            <td>{{object.created}}</td>
        </tr>
        <tr>
            <th>Last updated</th>
            <td>{{object.last_updated}}</td>
        </tr>
    </tbody>
</table>

{% if crud == "Read" and obj_perms.edit and object.revisions.count > 0 %}
<h2>Dataset revisions</h2>
<table class="table table-condensed table-striped">
    <colgroup>
        <col style="width: 10%;">
        <col style="width: 60%;">
        <col style="width: 15%;">
        <col style="width: 15%;">
    </colgroup>
    <thead>
        <tr>
            <th>Version</th>
            <th>Metadata</th>
            <th>Created</th>
            <th>Last updated</th>
        </tr>
    </thead>
    <tbody>
{% for revision in object.revisions.all %}
        <tr>
            <td>{{revision.version}}</td>
            <td>
                <ul>
                    <li><b>Filename:</b> {{revision.metadata.filename}}</li>
                    <li><b>Rows:</b> {{revision.metadata.num_rows}}</li>
                    <li><b>Columns:</b> {{revision.metadata.num_columns}}</li>
                    <li><b>Revision notes:</b> {{revision.notes|safe}}</li>
                </ul>
            </td>
            <td>{{revision.created}}</td>
            <td>{{revision.last_updated}}</td>
        </tr>
{% endfor %}
    </tbody>
</table>
{% endif %}

{% endblock content %}
