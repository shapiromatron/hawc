{% extends 'assessment-rooted.html' %}

{% load add_class %}

{% block content %}
    <h1>Outcomes ({{page_obj.paginator.count}} found)</h1>

    <div class="card">
        <div class="card-header">
            <button class="btn btn-link" data-toggle="collapse" data-target="#EndpointForm">
                Filter outcomes
            </button>
        </div>
        <div id="EndpointForm" class="collapse">
            <div class="card-body container-fluid">

            <form action="." method="get">
                <fieldset>
                    {{ form.non_field_errors|add_class:"alert alert-danger" }}

                    {% for field in form %}

                    {% if forloop.counter0|divisibleby:4 %}
                    <div class="row">
                        {% endif %}

                        <div class="col-md-3">
                            {{field.label_tag|add_class:"control-label"}}
                            <div class="form-group">
                                {{field}}<br>
                                <span class='text-muted'>{{field.help_text}}</span>
                            </div>
                            {{field.errors|add_class:"alert alert-danger"}}

                            {% if field.name == "order_by" and field.value is not None %}
                            <input type="hidden" id="initial_order_by" value="{{ field.value }}" />
                            {% endif %}
                        </div>

                        {% if forloop.counter0|add:1|divisibleby:4 %}
                    </div>
                    {% endif %}

                    {% endfor %}
                </fieldset>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Apply filters</button>
                </div>
            </form>


            </div>
        </div>
    </div>

    <div id='endpointTable'></div>

    {% if is_paginated %}
        <ul class="pagination justify-content-center">

            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?{% url_replace request 'page' page_obj.previous_page_number %}">&lt;&lt;</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="#">&lt;&lt;</a>
            </li>
            {% endif %}

            <li class="page-item disabled">
                <a class="page-link" href="#">{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</a>
            </li>

            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{% url_replace request 'page' page_obj.next_page_number %}">&gt;&gt;</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link" href="#">&gt;&gt;</a>
            </li>
            {% endif %}
        </ul>
    {% endif %}
{% endblock content %}

{% block extrajs %}
    {{ form.media }}
    <script type="text/javascript">
        window.app.epiStartup(function(epi){
            var outcomes = [];
            {{list_json|safe}}.map(function(outcome){
                outcomes.push(new epi.Outcome(outcome));
            })

            var tbl = new epi.OutcomeListTable(outcomes);
            $("#endpointTable").html(tbl.buildTable());
        });
    </script>
{% endblock %}
